{"version":3,"sources":["webpack://@block-cat/guest-gamification/webpack/bootstrap","webpack://@block-cat/guest-gamification/external \"flarum.core.compat['common/utils/classList']\"","webpack://@block-cat/guest-gamification/external \"flarum.core.compat['common/components/Button']\"","webpack://@block-cat/guest-gamification/external \"flarum.core.compat['common/extend']\"","webpack://@block-cat/guest-gamification/external \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@block-cat/guest-gamification/./src/forum/index.js","webpack://@block-cat/guest-gamification/./src/forum/helpers/saveVote.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","app","initializers","add","extensions","setting","helpers","extend","CommentPost","items","has","post","this","attrs","hasDownvoted","hasUpvoted","icon","upVotesOnly","canSeeVotes","canVote","onclick","upvoted","downvoted","load","discussion","redraw","save","then","pushAttributes","votes","saveVote","val","voteLoading","replace","className","classList","Button","component","undefined","loading","disabled","translator","trans"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = flarum.core.compat['common/utils/classList'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","import { extend } from 'flarum/common/extend';\r\nimport CommentPost from 'flarum/forum/components/CommentPost';\r\nimport Button from 'flarum/common/components/Button';\r\nimport classList from 'flarum/common/utils/classList';\r\nimport saveVote from './helpers/saveVote';\r\n\r\napp.initializers.add('block-cat/guest-gamification', () => {\r\n  // exit if 'fof-gamification' isn't active\r\n  if (!flarum.extensions['fof-gamification']) return;\r\n\r\n  // import 'setting' function from 'fof-gamification.helpers'\r\n  const {\r\n    setting\r\n  } = flarum.extensions['fof-gamification'].helpers;\r\n\r\n  // console.log(flarum.extensions['fof-gamification'].helpers);\r\n  extend(CommentPost.prototype, 'actionItems', function (items) {\r\n    if (items.has('votes')) {\r\n      // same code from 'fof-gamification'\r\n      const post = this.attrs.post;\r\n      \r\n      const hasDownvoted = post.hasDownvoted();\r\n      const hasUpvoted = post.hasUpvoted();\r\n      \r\n      const icon = setting('iconName') || 'thumbs';\r\n      const upVotesOnly = setting('upVotesOnly', true);\r\n      \r\n      const canSeeVotes = post.canSeeVotes();\r\n      \r\n      // We set canVote to true for guest users so that they can access the login by clicking the button\r\n      const canVote = post.canVote(); // modified by BkC\r\n      \r\n      // saveVote was created in './helpers/saveVote' and modified by BkC\r\n      const onclick = (upvoted, downvoted) => saveVote(post, upvoted, downvoted, (val) => (this.voteLoading = val));\r\n      \r\n      // replace with same component but\r\n      // onclick call another 'saveVote' function\r\n      items.replace(\r\n        'votes',\r\n        <div className={classList('CommentPost-votes', setting('useAlternateLayout', true) && 'alternateLayout')}>\r\n          {Button.component({\r\n            icon: this.voteLoading ? undefined : `fas fa-fw fa-${icon}-up`,\r\n            className: classList('Post-vote Post-upvote', hasUpvoted && 'Post-vote--active'),\r\n            loading: this.voteLoading,\r\n            disabled: this.voteLoading || !canVote || !canSeeVotes,\r\n            onclick: () => onclick(!hasUpvoted, false),\r\n            'aria-label': app.translator.trans('fof-gamification.forum.post.upvote_button'),\r\n          })}\r\n\r\n          <label className=\"Post-points\">{post.votes()}</label>\r\n\r\n          {!upVotesOnly &&\r\n            Button.component({\r\n              icon: this.voteLoading ? undefined : `fas fa-fw fa-${icon}-down`,\r\n              className: classList('Post-vote Post-downvote', hasDownvoted && 'Post-vote--active'),\r\n              loading: this.voteLoading,\r\n              disabled: !canVote || !canSeeVotes,\r\n              onclick: () => onclick(false, !hasDownvoted),\r\n              'aria-label': app.translator.trans('fof-gamification.forum.post.downvote_button'),\r\n            })}\r\n        </div>,\r\n        10\r\n      );\r\n    }\r\n  });\r\n});\r\n","export default (post, upvoted, downvoted, load, discussion = post.discussion()) => {\r\n  // BkC deleted 'if(!app.session.user)' condition from here\r\n  if (discussion && !discussion.canVote() && !post.canVote()) {\r\n    return;\r\n  }\r\n\r\n  if (upvoted && downvoted) {\r\n    upvoted = false;\r\n    downvoted = false;\r\n  }\r\n\r\n  if (load) load(true);\r\n\r\n  m.redraw();\r\n\r\n  return post\r\n    .save([upvoted, downvoted, 'vote'])\r\n    .then(\r\n      () => null,\r\n      () => null\r\n    )\r\n    .then(() => {\r\n      if (load) load(false);\r\n\r\n      if (discussion) {\r\n        discussion.pushAttributes({\r\n          votes: post.votes(),\r\n        });\r\n      }\r\n\r\n      m.redraw();\r\n    });\r\n};"],"sourceRoot":""}